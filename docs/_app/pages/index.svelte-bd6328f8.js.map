{"version":3,"file":"index.svelte-bd6328f8.js","sources":["../../../../../src/lib/IFrame.svelte","../../../../../src/lib/index.svelte","../../../../../src/routes/index.svelte"],"sourcesContent":["<script>\r\n\texport let iframe;\r\n\texport let srcdoc;\r\n\texport let serializedSource;\r\n</script>\r\n\r\n<div class=\"iframe-container\">\r\n\t<div class=\"header\">\r\n\t\t{#if !serializedSource}\r\n\t\t\tRendering...\r\n\t\t{/if}\r\n\t</div>\r\n\t<div class=\"iframe-inner\">\r\n\t\t<iframe title=\"Rendered REPL\" bind:this={iframe} {srcdoc} />\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.header {\r\n\t\tfont-weight: 700;\r\n\t\tfont-size: 0.8rem;\r\n\t\ttext-transform: uppercase;\r\n\t\tcolor: rgba(0, 0, 0, 0.7);\r\n\t}\r\n\tiframe {\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t\tborder: 0;\r\n\t}\r\n\t.iframe-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tborder: 1px solid #a2a2a252;\r\n\t\t-webkit-border-radius: 4px;\r\n\t\t-moz-border-radius: 4px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\t.iframe-inner {\r\n\t\tflex: 1;\r\n\t\theight: 100%;\r\n\t}\r\n</style>\r\n","<script>\r\n\timport IFrame from './IFrame.svelte';\r\n\r\n\t// export let error; // TODO should this be exposed as a prop?\r\n\t// export let status;\r\n\t// export let truncate;\r\n\r\n\t// import okaidia from \"../../prism/okaidia.js\"; // prism CSS for code\r\n\texport let srcdoc;\r\n\texport let esModule;\r\n\texport let props;\r\n\texport let injectedCSS = `/* Some STYLES */\r\n\thtml, body {position: relative;width: 100%;height: 100%;}body {color: #333;margin: 0;padding: 0px 2px;box-sizing: border-box;font-family: -apple-system, \"Segoe UI\", BlinkMacSystemFont, Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif;}a {color: rgb(0,100,200);text-decoration: none;}a:hover {text-decoration: underline;}a:visited {color: rgb(0,80,160);}label {display: block;}input, button, select, textarea {font-family: inherit;font-size: inherit;padding: 0.4em;margin: 0 0 0.5em 0;box-sizing: border-box;border: 1px solid #ccc;border-radius: 2px;}input:disabled {color: #ccc;}input[type=\"range\"] {height: 0;}button {color: #333;background-color: #f4f4f4;outline: none;}button:active {background-color: #ddd;}button:focus {border-color: #666;} p:last-child{margin-bottom: 30px;}\t\r\n\t`;\r\n\r\n\texport let serializedSource;\r\n\tconst UPDATED = 'updated';\r\n\r\n\tlet iframe;\r\n\r\n\t$: esModule && update({ esModule, props });\r\n\t$: iframe && iframe.addEventListener('load', handleLoad);\r\n\r\n\t// Wait for the iframe to load, then configure it\r\n\tconst handleLoad = async () => {\r\n\t\twindow.addEventListener(\r\n\t\t\t'message',\r\n\t\t\t(event) => {\r\n\t\t\t\tif (iframe && event.data == UPDATED) {\r\n\t\t\t\t\t// console.log(\"iframe updated\", event.data);\r\n\t\t\t\t\tserializedSource = new XMLSerializer().serializeToString(iframe?.contentWindow.document);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\tupdate({ esModule, props });\r\n\t};\r\n\r\n\tfunction update({ esModule, props }) {\r\n\t\tif (!iframe) return;\r\n\t\tiframe.contentWindow.postMessage({ esModule, props }, location.origin); // \"*\" origin wildcard\r\n\t}\r\n\r\n\t$: srcdoc = `\r\n\t\t<!doctype html>\r\n\t\t<html>\r\n\t\t\t<head>\r\n\t\t\t\t<script id=\"injected-base64-script\">\r\n\t\t\t\t\t// insert var src64 here\r\n\t\t\t\t\t// var me = document.getElementById('injected-base64-script');\r\n\t\t\t\t<\\/script>\r\n\t\t\t\t<link href=\"https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css\" rel=\"stylesheet\" />\r\n\t\t\t\t<style>\r\n\t\t\t\t\t/* STYLES */\r\n\t\t\t\t\t${injectedCSS}\r\n\t\t\t\t<\\/style>\r\n\t\t\t\t<script type=\"module\">\r\n\r\n\t\t\t\t\tlet component;\r\n\r\n\t\t\t\t\tif(typeof src64 != 'undefined'){\r\n\t\t\t\t\t\tconsole.log('pre-existing src64, convert and load')\r\n\t\t\t\t\t\tfetch(src64).then(async function(response){\r\n\t\t\t\t\t\t\tconst blob = await response.blob()\r\n\t\t\t\t\t\t\tconst url = URL.createObjectURL(blob);\r\n\t\t\t\t\t\t\timport(url).then(function ({ default: App }) {\r\n\t\t\t\t\t\t\t\tif (component) component.$destroy();\r\n\t\t\t\t\t\t\t\tdocument.getElementById('app').innerHTML = '';\r\n\t\t\t\t\t\t\t\tcomponent = new App({ target: document.getElementById('app') })\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// console.log('no pre-existing src64')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tasync function fetchedBlobToDataURL (blobUrl) {\r\n\r\n\t\t\t\t\t\treturn new Promise(async function (resolve, reject) {\r\n\r\n\t\t\t\t\t\t\tconst response = await fetch(blobUrl);\r\n\t\t\t\t\t\t\tconst blob = await response.blob()\r\n\r\n\t\t\t\t\t\t\tvar blobAsDataUrl\r\n\t\t\t\t\t\t\tvar reader = new FileReader();\r\n\r\n\t\t\t\t\t\t\treader.addEventListener(\"load\", function () {\r\n\t\t\t\t\t\t\t\tblobAsDataUrl = this.result;\r\n\t\t\t\t\t\t\t\tresolve(blobAsDataUrl)\r\n\t\t\t\t\t\t\t}, false);\r\n\r\n\t\t\t\t\t\t\treader.readAsDataURL(blob)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// <!-- Turn the string into actual javascript code -->\r\n\t\t\t\t\t// <!--   import (url) <- ObjectURL <- Blob         -->\r\n\r\n\t\t\t\t\tasync function update({esModule, props}) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// <!-- type: 'text/javascript would normally come from response headers -->\r\n\t\t\t\t\t\tconst blob = new Blob([esModule], { type: 'text/javascript' });\r\n\t\t\t\t\t\tconst url = URL.createObjectURL(blob);\r\n\t\t\t\t\t\tconst src64 = await fetchedBlobToDataURL(url)\r\n\r\n\t\t\t\t\t\tvar oldElement = document.getElementById('injected-base64-script');\r\n\t\t\t\t\t\toldElement.parentNode.removeChild(oldElement);\r\n\r\n\t\t\t\t\t\tvar newElement = document.createElement(\"script\");\r\n\t\t\t\t\t\tnewElement.setAttribute('id', 'injected-base64-script');\r\n\t\t\t\t\t\tvar textnode = document.createTextNode(\"var src64 = '\" + src64 + \"'\");\r\n\t\t\t\t\t\tnewElement.appendChild(textnode);\r\n\t\t\t\t\t\tdocument.getElementsByTagName('head').item(0).prepend(newElement);\r\n\r\n\t\t\t\t\t\timport(url).then(function ({ default: App }) {\r\n\t\t\t\t\t\t\tif (component) component.$destroy();\r\n\r\n\t\t\t\t\t\t\tdocument.getElementById('app').innerHTML = '';\r\n\t\t\t\t\t\t\tcomponent = new App({ \r\n\t\t\t\t\t\t\t\ttarget: document.getElementById('app'), \r\n\t\t\t\t\t\t\t\tprops: { ...props }\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t// URL.revokeObjectURL(url) // memory management \r\n\r\n\t\t\t\t\t\t\twindow.parent.postMessage(\"${UPDATED}\", window.parent)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.addEventListener('message', function (event) {\r\n\t\t\t\t\t\tupdate({ ...event.data })\r\n\t\t\t\t\t}, false)\r\n\r\n\t\t\t\t<\\/script>\r\n\t\t\t</head>\r\n\t\t\t<body>\r\n\t\t\t\t<div id=\"app\"></div>\r\n\t\t\t</body>\r\n\t\t</html>\r\n\t`;\r\n</script>\r\n\r\n<IFrame bind:iframe {srcdoc} {serializedSource} />\r\n<!-- <div class=\"iframe-container\">\r\n\t<div style=\"height: 100%\">\r\n\t\t<iframe title=\"Rendered REPL\" bind:this={iframe} {srcdoc} />\r\n\t</div>\r\n</div> -->\r\n","<script>\n\timport { onMount } from 'svelte';\n\timport Gateway from '$lib/index.svelte';\n\n\tlet url = 'https://bafybeidchd6z3eydlkl7sloi4banjjk46aurusxj2ky2v5zj7zzzwsgwsq.ipfs.cf-ipfs.com/';\n\n\tlet component;\n\n\tlet props = { name: 'Douglas' };\n\tlet mounted;\n\tonMount(() => {\n\t\t// fetch the svelte component url variable and mount the Svelte app to target element\n\t\t// mount svelte iife component to dom target\n\t\t// import(`${url}`).then((module) => {\n\t\t// \tmodule.default.mount(document.getElementById('app'));\n\t\t// });\n\n\t\tmounted = true;\n\t});\n\n\t$: if (url) doFetch(url);\n\n\tlet fetched;\n\n\tasync function doFetch(url) {\n\t\ttry {\n\t\t\tfetched = await fetch(url);\n\t\t\tconst text = await fetched.text();\n\t\t\tcomponent = text;\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\t}\n\n\t// .then((response) => response.text())\n\t// .then((text) => {\n\t// \tcomponent = text;\n\t// });}\n</script>\n\n<main class=\"m-4\">\n\t<h1 class=\"text-3xl font-bold py-2\">Svelte Component Gateway</h1>\n\t<p class=\"my-2\">\n\t\tLoading from // make form input with url default\n\t\t<input type=\"text\" name=\"url\" bind:value={url} size=\"90\" class=\"border p-2\" />\n\t\t<a href={url} target=\"_blank\" class=\"underline text-blue-400\">{url}</a>\n\t</p>\n\n\tProps: {JSON.stringify(props)}\n\n\t{#if component}\n\t\t<Gateway esModule={component} {props} />\n\t{/if}\n\t<!-- {component} -->\n</main>\n"],"names":["create_if_block"],"mappings":";;;;;;eAQyB,cAEvB;AAAA;;4BAFuB,cAEvB;AAAA;;;;;;;;;;;;;;;;kBAFM,IAAgB,MAAAA,kBAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFxB,uBASM,QAAA,MAAA,MAAA;AARL,uBAIM,MAAA,IAAA;;;;AACN,uBAEM,MAAA,IAAA;AADL,uBAA4D,MAAA,QAAA;;;;WALtD,KAAgB,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAPZ,WAAM;QACN,WAAM;QACN,qBAAgB;;;AAUe,eAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACG1C,MAAA,UAAU;;QARL,WAAM;QACN,aAAQ;QACR,UAAK;QACL,cAAW;AAAA;AAAA;QAIX,qBAAgB;MAGvB;QAME,aAAU,YAAA;AACf,WAAO,iBACN,WACC,WAAK;AACD,UAAA,UAAU,MAAM,QAAQ,SAAO;wBAElC,mBAAgB,IAAO,cAAa,EAAG,kBAAkB,iCAAQ,cAAc,QAAQ,CAAA;AAAA;OAGzF;AAGD,WAAM,EAAG,UAAU,MAAK,CAAA;AAAA;kBAGV,EAAG,qBAAU,iBAAK;SAC3B;AAAM;AACX,WAAO,cAAc,YAAW,EAAG,qBAAU,iBAAS,SAAS,MAAM;AAAA;;;;;;;;;;;;;;;;;;;AArBnE,kBAAY,OAAS,EAAA,UAAU,MAAK,CAAA;AAAA;;AACpC,gBAAU,OAAO,iBAAiB,QAAQ,UAAU;AAAA;;sBAuBpD,SAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAWH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAsE6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gBC1Ef,IAAS;AAAA;;;;;;;;;;;;;;;;;mCAAT,KAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iBAHrB,KAAK,UAAU,IAAK,EAAA,IAAA;;;;;;iBAEvB,IAAS,MAAA,gBAAA,GAAA;;;;;gBATsB,0BAAwB;;;gBAC7C,sDAEd;;;;gBAC+D,IAAG,EAAA;gBAChE,cAEI;;;;;;;;;;;;gCAP6B,0BAAwB;;;;;+BAC7C,sDAEd;;;;;;;;;;+BAC+D,IAAG,EAAA;;;kCAChE,cAEI;;;;;;;;;;;;;;sBAHG,IAAG,EAAA;;;;;;;AALd,uBAcM,QAAA,MAAA,MAAA;AAbL,uBAAgE,MAAA,EAAA;;;AAChE,uBAIG,MAAA,CAAA;;AAFF,uBAA6E,GAAA,KAAA;6BAAnC,IAAG,EAAA;;AAC7C,uBAAsE,GAAA,CAAA;;;;;;;;;;;;;;uCAD5B,KAAG,IAAA;+BAAH,KAAG,EAAA;AAAA;;qBACkB,KAAG,EAAA;;wBAAzD,KAAG,EAAA;AAAA;UAKR,KAAS,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA9CV,MAAA,MAAM;MAEN;MAEA,QAAK,EAAK,MAAM;AAEpB,UAAO,MAAA;AAAA;MAYH;AAEW,yBAAQ,MAAG;;AAExB,gBAAO,MAAS,MAAM,IAAG;YACnB,QAAI,MAAS,QAAQ;AAC3B,mBAAA,GAAA,YAAY,KAAI;AAAA,aACR;AACR,cAAQ,IAAI,KAAK;AAAA;;;AAcwB,UAAG,KAAA;;;;;AAxBvC,UAAA;AAAK,gBAAQ,GAAG;AAAA;;;;;;;;;;;"}